@layout MainLayout
@page "/patient-management"
@using Dexterity.Components.Pages.PatientManager.Components.PatientOptions
<style>
    .mud-tabs-toolbar-content {
        overflow-x: scroll !important;
    }

        .mud-tabs-toolbar-content::-webkit-scrollbar {
            display: none !important;
        }
</style>

<TopTitleBar Title="Patient Management" Image="modules/patients.svg"/>
<MudItem md="12" Class="vertical-space">
    <InnerLayout AllHeight="850px">
        <NavigationItems>
            <MudNavLink Match="NavLinkMatch.All" Icon="fas fa-person-circle-plus" IconColor="MudColor.Info"
                        @onclick="@(AddNewPatient)">
                Quick Patient
            </MudNavLink>
            <MudNavLink Match="NavLinkMatch.All" Icon="fas fa-user-plus" IconColor="MudColor.Info"
                        @onclick="@(() => ClickChangedTab(1))">
                Add Patient
            </MudNavLink>

            <MudNavLink Match="NavLinkMatch.All" Icon="fas fa-user-pen" IconColor="MudColor.Info"
                        @onclick="@(() => ClickChangedTab(0))">
                Open Patient
            </MudNavLink>
            <MudNavLink Match="NavLinkMatch.All" Icon="fas fa-family" IconColor="MudColor.Info"
                        @onclick="@(() => ClickChangedTab(2))">
                Patient Group Centre
            </MudNavLink>
            <MudNavLink Match="NavLinkMatch.All" Icon="fas fa-rectangle-list" IconColor="MudColor.Info"
                        @onclick="@(() => ClickChangedTab(3))">
                Open Patient Summary
            </MudNavLink>
            <MudNavLink Match="NavLinkMatch.All" Icon="fas fa-solid fa-file-user" IconColor="MudColor.Info"
                        @onclick="@(() => ClickChangedTab(4))">
                Patients Accounts
            </MudNavLink>
            <MudDivider/>
            <MudNavGroup Title="Patient Options">
                <MudItem>
                    <MudNavLink Match="NavLinkMatch.All" Icon="fas fa-calendar-clock" IconColor="MudColor.Info"
                                @onclick="@(() => ClickChangedTab(5))">
                        Hospital Viewer
                    </MudNavLink>
                </MudItem>

            </MudNavGroup>
        </NavigationItems>

        <DexContentTabs>
            <div class="d-flex justify-center align-center mt-lg-5" style="width: 100%!important;">
                <MudTabs @ref="_tabs">
                    <MudTabPanel Text="">
                        <OpenPatient TabChangeClick="ClickChangedTab"/>
                    </MudTabPanel>
                    <MudTabPanel Text="">
                        <AddNewPatient/>
                    </MudTabPanel>
                    <MudTabPanel Text="">
                        <PatientGroup/>
                    </MudTabPanel>
                    <MudTabPanel Text="">
                        <PatientSummary TabChangeClick="ClickChangedTab"/>
                    </MudTabPanel>
                    <MudTabPanel Text="">
                        <PatientAccounts/>
                    </MudTabPanel>
                    <MudTabPanel Text="">
                        <HospitalViewer/>
                    </MudTabPanel>
                </MudTabs>
            </div>

        </DexContentTabs>
    </InnerLayout>
</MudItem>

@code {
    MudTabs _tabs;

    private void ClickChangedTab(int tabIndex)
    {
        if (tabIndex is 0 or 3 or 4)
        {
            ApplicationState.SelectedPatientId = Guid.Empty;
        }

        _tabs.ActivatePanel(tabIndex);
    }

    private async Task AddNewPatient()
    {
        var parameters = new DialogParameters();
        var options = new DialogOptions() {CloseButton = true, MaxWidth = MaxWidth.Small, FullWidth = true, Position = DialogPosition.Center};
        await DialogService.ShowAsync<QuickAddPatientModal>("New Patient", parameters, options);
    }

}